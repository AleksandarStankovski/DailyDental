<app-loading-overlay *ngIf="loadingOverlay"></app-loading-overlay>
<div class="md-dialog-header"></div>
<md-dialog-content>
    <form (ngSubmit)="appointmentForm.valid && save()" #appointmentForm="ngForm" novalidate>
        <p [hidden]="manipulations?.length > 0">Моля, преди да запишете час, създайте манипулация.</p>
        <div>
            <md-select [(ngModel)]="appointment.doctor" name="doctor" required #appointmentDoctor="ngModel" placeholder="Лекар" class="input-full-width">
                <md-option *ngFor="let doctor of doctors" [value]="doctor._id">
                    д-р. {{doctor.lastName}}
                </md-option>
            </md-select>
        </div>
        <div>
            <md-select [(ngModel)]="appointment.startTime" (change)="durationFilter()" name="startTime" required #appointmentStartTime="ngModel" placeholder="Час" class="input-full-width">
                <md-option *ngFor="let hour of hours" [value]="hour.value">
                    {{hour.name}}
                </md-option>
            </md-select>
        </div>
        <div>
            <md-select [(ngModel)]="appointment.duration" name="duration" required #appointmentDuration="ngModel" placeholder="Времетраене" class="input-full-width">
                <md-option *ngFor="let hour of durationHours" [value]="hour">
                    {{hour}}
                </md-option>
            </md-select>
        </div>
        <div>
            <md-form-field class="input-full-width">
                <input mdInput [(ngModel)]="appointment.patient.firstName" name="patientFirstName" required #appointmentPatientFirstName="ngModel" placeholder="Име на пациента">
            </md-form-field>
        </div>
        <div>
            <md-form-field class="input-full-width">
                <input mdInput [(ngModel)]="appointment.patient.lastName" name="patientLastName" required #appointmentPatientLastName="ngModel" placeholder="Фамилия на пациента">
            </md-form-field>
        </div>
        <div>
            <md-form-field class="input-full-width">
                <input mdInput [(ngModel)]="appointment.patient.phone" name="patientPhone" required #appointmentPatientPhone="ngModel" placeholder="Телефон на пациента">
            </md-form-field>
        </div>
        <div [hidden]="manipulations?.length === 0">
            <md-select [(ngModel)]="appointment.manipulations" [multiple]="true" name="manipulation" required #appointmentManipulation="ngModel" placeholder="Манипулация" class="input-full-width">
                <md-option *ngFor="let manipulation of manipulations" [value]="manipulation._id">
                    {{manipulation.name}}
                </md-option>
            </md-select>
        </div>
        <div>
            <md-form-field class="input-full-width">
                <textarea  mdInput [(ngModel)]="appointment.comment" name="comment" #appointmentComment="ngModel" placeholder="Забележка"></textarea>
            </md-form-field>
        </div>
    </form>
</md-dialog-content>
<md-dialog-actions class="justify-content-end">
    <button md-button [md-dialog-close]="'cancel'">Затвори</button>
    <button *ngIf="data.appointmentId" md-button (click)="delete()">Изтрий</button>
    <button md-button (click)="save()" [disabled]="appointmentForm.invalid">Запази</button>
</md-dialog-actions>